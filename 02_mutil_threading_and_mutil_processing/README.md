# 멀티쓰레딩과 멀티 프로세싱

- 컴퓨터 구조와 OS 기본
    - 컴퓨터의 구성 요소
        - CPU
            - 명령어를 해석하여 실행하는 장치
        - 메모리
            - 주메모리(램) : 작업에 필요한 프로그램과 데이터를 저장하는 장소
            - 보조메모리(HDD) : 저장장치라고 불리며 데이터를 일시적 또는 영구적으로 저장하는 장소
        - 입출력장치
            - 키보드
            - 스피커
            - 모니터
        - 시스템버스
            - 각각의 구성요소들을 연결해주고 데이터를 주고받게 해주는것
    - 운영체제
        - 정의 : 컴퓨터 시스템을 운영하고 관리하는 소프트웨어
        - 운영체제가 없는 컴퓨터는 처음에 설계한 대로만 사용할 수 있는 단순 계산기에 불과
        - 운영체제가 있는 컴퓨터를 프로그래밍 가능한 기계라고 한다.
        - Window OS, Mac OS, Ubuntu
    - 프로세스(실행을 위해 주메모리에 올라온 동적인 상태)
        - 프로그램 : 어떤 문제를 해결하기 위해 컴퓨터에게 주어지는 처리 방법과 순서를 기술한 일련의 명령문의 집합체 (저장장치에 저장된 정적인 상태)
        - 프로그램은 HDD(하드디스크),SSD와 같은 저장장치에 보관되어있다. 사용자는 어떤 이유로 프로그램을 실행하기 위해 프로그램 바로가기 버튼을 눌러서 실행한다.
        - 프로그램이 실행된다? -> 해당 프로그램의 작성된 코드들이 주메모리로 올라와서 작업이 진행된다. -> 프로세스가 생성되면 CPU는 프로세스가 해야할 작업을 수행한다.
    - 스레드
        - 프로세스가 생성되면 CPU는 프로세스가 해야할 작업을 수행한다. 이때 CPU가 처리하는 작업의 단위가 스레드이다. -> 스레드란 프로세스 내에서 실행되는 여러 작업의 단위
        - 스레드가 한개면 싱글 스레드, 여러개의 스레드가 동작하면 멀티 스레딩 -> 멀티 스레딩에서 스레드는 다수의 스레드끼리 메모리 공유와 통신이 가능 -> **장점** : 자원의 낭비를 막고 효율성 향상 -> **단점** : 한 스레드에 문제가 생기면 전체 프로세스에 영향이 있음
        - 종류
            - 사용자 수준 스레드(파이썬에선 사용자 수준 스레드 제공)
            - 커널 수준 스레드

- 동시성 vs 병렬성
    - 동시성(병행성) vs 병렬성
        - 동시성(concurrency) at the same time이 아님
            - 동시성이란 한 번에 여러작업을 동시(스위칭을 하면서 여러작업을 동시에)에 다룬다는 의미 (동시성은 논리적 개념으로 멀티 스레딩에서 사용되기도 하고 또한 싱글 코어 뿐만 아니라 멀티 코어에서도 각각의 코어가 동시성을 사용할 수 있다.)
                - 라면 요리작업(라면물을끓임 -> 스위칭 -> 케익 요리 작업(밀가루 반죽) -> 스위칭 -> 파스타 요리 작업(재료 손질) -> 스위칭 -> 라면 스프넣기 -> 스위칭 -> 케익 요리 작업(오븐 구이)
        - 병렬성(parallelism) at the same time임 , 파이썬에서는 멀티 스레드로 구현을해도 GIL 때문에 멀티 스레드가 병렬적으로 실행되지 못하므로 꼭 멀티스레드는 동시성으로 동작하게 해야함
            - 병렬성이란 한 번에 여러작업을 병렬적으로 처리하는것을 의미
                - 라면 요리를 하는 사람 1명과, 케익 요리 작업을 하는사람 1명과, 파스타 요리 작업을 하는 사람 1명을 각각 배치하여 (사람=cpu코어) 진행하는 방법

- 파이썬 멀티스레딩
    - 파이썬에서의 멀티스레딩은 병렬적으로 동작하지않음.(동시성 기반으로 작동됨)
    - 코루틴을 사용하는것을 권장(쓰레드를 만드는것 자체의 비용과, 쓰레드마다 우선순위를 부여하는 비용 을 고려했을때 **메모리 점유율이 훨씬 높기 때문**)

- 멀티스레딩의 단점
    - 멀티 스레딩은 스레드끼리 자원을 공유함. 하나의 자원을 동시에 여러 스레드에서 가져가려는 상황에서 충돌이 발생할 수 있음. 이 경우 하나의 스레드가 다른 스레드에 의해 차단될 수 있음.
    - 파이썬의 **GIL**은 이러한 문제를 막아줌.

- 파이썬 멀티프로세싱
    - 전역 인터프리터 잠금(GIL, Global Interpreter Lock)
        - 한번에 1개의 스레드만 유지하는 락
        - GIL은 본질적으로 한 스레드가 다른 스레드를 차단해서 제어를 얻는것을 막아준다. 멀티스레딩의 위험으로부터 보호해줌
            - 이때문에 파이썬에서는 스레드로 병렬성을 연산을 수행하지 못함. -> 파이썬 멀티 스레딩은 동시성을 사용하여 io bound 코드에서 유용하게 사용할 수 있지만 cpu bound 코드에서는 GIL에 의해 원하는 결과 값을 얻지 못함.
    - 장점
        - 멀티 프로세싱은 프로세스 자체를 복제하기 때문에 위에서 설명한 문제를 해결할 수 있음.
    - 단점
        - 프로세스 자체를 복제하기 때문에 자원을 공유할 수 없기에 서로 통신을 위한 직렬화,역직렬화 와 같은 추가 작업에 대한 비용이 큰편이다.(비용을 지불해서라도 속도를 높이고 성능을 높이고 싶으면 사용)