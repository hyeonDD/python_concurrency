# 비동기함수

- 바운드와 블로킹
    - 바운드는 크게 I/O 바운드와 CPU 바운드로 나뉜다.
        - CPU 바운드
            - 프로그램이 실행될 때 실행속도가 CPU 속도에 의해 제한됨을 의미한다.
            - 정말 복잡한 수학 수식을 계산하는 경우에 프로그램의 실행속도가 느려진다.
        - I/O 바운드
            - 여기서 I는 Input을 의미하고 O는 Output을 의미한다.
            - 프로그램이 실행될 때 실행 속도가 I/O에 의해 제한됨을 의미한다.
            - 사용자가 입력을 하고 해당하는 입력에 대해 더하기 100을 한 결과값을 출력해주는 프로그램을 개발한다고 가정할때
            - 사용자가 키보드로 숫자를 입력하는 경우 뿐만 아니라, 컴퓨터와 컴퓨터가 통신을 할때에도 I/O 바운드가 발생.
    - 블로킹이란
        - 바운드에 의해 코드가 멈추게 되는 현상이 일어나는것

- 동기와 비동기
    - 동기(일반적인 time.sleep)
        - 코드가 동기적으로 동작한다 => 코드가 반드시 작성된 순서 그대로 실행된다.
        - 짜장면 배달부가 작업을 동기적으로 수행했을 때(A에게 배달을 완료한후 A가 다먹을때까지 현관 앞에서 기다린다.) -> 20분후에 A가 다먹은 그릇을 수거하고 B에게 배달. -> 13분 후 B가 다먹을때까지 기다리고 그릇을 수거하고, C에게 배달. -> C는 주문한지 33분 + T 만큼 기다리게 되어 화가남
    - 비동기(어싱크(async) 함수(코루틴 함수)) (요청과 응답이 필요할때 사용하면 유용하다)
        - 코드가 비동기적으로 동작한다 => 코드가 반드시 작성된 순서 그대로 실행되는것이 아니다.
        - 짜장면 배달부가 작업을 비동기적으로 수행했을 때(A에게 배달을 완료한후 A가 다먹을때까지 기다리지 않고 바로 B에게 배달) -> B가 먹을때까지 기다리지않고 C에게 배달 -> C에게 배달을 완료한후 A의 그릇을 수거하러감 -> B의 그릇을 수거하러감 -> C의 그릇을 수거하러감
    
- **await** 키워드는 단순히 동기적으로 진행하는걸 도와주는것 뿐만아니라 await을 기점으로 다른 코루틴으로 넘어가도록 해주는 키워드이다 (동기를 비동기로 기다리게 해주는것이 아니라 비동기 함수를 처리할때 필요한 키워드).

```
# async 비동기 함수를 사용했지만 실제로는 sync(동기)적으로 동작는 예
import time
import asyncio

async def delivery(name, mealtime):
    print(f"{name}에게 배달완료!")
    await asyncio.sleep(mealtime)
    print(f"{name} 식사 완료, {mealtime}시간 소요...")
    print(f"{name} 그릇 수거 완료")

async def main():
    await delivery("A",5)
    await delivery("B",3)
    await delivery("C",4)

if __name__ == "__main__":
    start = time.time()
    asyncio.run(main())
    end = time.time()
    print(end-start)
```

- 파이썬 코루틴 (루틴: 일련의 명령(코드의흐름))
    - 메인 루틴
        - 프로그램의 메인 코드 흐름
    - 서브 루틴
        - 우리가 알고있는 보통의 함수나 메소드(메인 루틴을 보조하는 역할)
        - 프로그램이 실행되면 서브 루틴은 별도의 공간(스코프)에 해당 로직들을 모아놓고 있다. 서브루틴이 호출 될 때, 해당하는 로직들의 공간으로 이동했다가 return문을 통해 원래 호출시점(메인 루틴)으로 돌아오게 된다.
        - 하나의 진입점과 하나의 탈출점이 있는 루틴이다.
    - 코루틴
        - 서브 루틴의 일반화된 형태
        - 다양한 진입점과 다양한 탈출점(await,return 등)이 있는 루틴
        - 파이썬 비동기 함수는 코루틴 함수로 만들 수 있다.

- **await** 키워드 주의사항
    - await 키워드는 아무데나 쓸 수 있는 키워드가 아니라, 어웨이터블한 객체 앞에서만 사용할 수 있는 키워드이다.

- 어웨이터블한 객체란?
    - 주요 유형으로 3가지(코루틴,테스크,퓨처)가 있다.
    - 코루틴
        - async 키워드를 사용하여 만든 함수?
    - 테스크란?
        - 코루틴을 동시에 예약할때 사용함
        - asyncio.create_task(코루틴)로 테스크를 생성할 수 있다.
        ```
        task1 = aysncio.create_task(delivery("A",3))
        task2 = aysncio.create_task(delivery("B",1))

        await task1
        await task2

        와
        await delivery("A",3)
        await delivery("B",1) 과 똑같음
        ```
    - 퓨처란?
        - 비동기연산의 최종 결과를 나타내는 특별한 **저수준** 어웨이터블 객체
        - 멀티쓰레딩과 멀티프로세싱에서 사용

- asyncio의 주요 메서드
    - asyncio.run(coro, *, debug=False)
        - 코루틴을 실행하고 결과를 반환하는것
    - asyncio.sleep(delay, result=None)
        - 코루틴을 블로킹하는것(현재 테스크를 일시중단하여 다른 테스크를 실행할 수 있게 해줌)
    - asyncio.gather(*aws, return_exceptions=False)
        - aws 시퀀스에 있는 어웨이터블 객체를 동시에 실행합니다. aws에 있는 어웨이터블이 코루틴이면 자동으로 태스크로 예약됩니다. 모든 어웨이터블이 성공적으로 완료되면, **결과**는 반환된 값들이 합쳐진 리스트입니다. 결괏값의 순서는 aws에 있는 어웨이터블의 순서와 일치합니다.
    
- fetcher의 의미
    - 해당하는 세션의 url을 보내서 해당하는 url에 대한 데이터를 가지고오는것(return 해줌)